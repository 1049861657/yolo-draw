# YOLO船舶标注工具

这是一个用于处理YOLO检测结果的船舶图像标注工具。该工具可以加载YOLO格式的图像和标签文件，允许用户查看并修改船舶的类型标签，支持标注框的交互式编辑，并能将标注完成的文件按类别分类保存到指定的目标文件夹。

## 主要功能

### 基础功能
- 浏览和加载YOLO格式的图像和对应txt标签文件
- 在图像上显示检测框并支持交互式查看与编辑
- 支持拖拽调整边界框位置和大小
- 支持多种船舶类型标注：船牌、船名、国旗、遮挡船名
- 便捷的船舶类型标签修改界面，一键标注并移动
- 标注完成后自动将文件按船舶类型分类保存到目标文件夹

### 高级功能
- **智能ID分组**: 自动按图像ID将相关图像分组显示，便于批量处理
- **批量标注**: 支持批量选择图像进行批量标注和移动
- **AI自动分类**: 集成YOLO模型，支持自动分类功能
- **审核模式**: 可选择是否保留原文件，舍弃时可删除原文件
- **标注统计**: 实时显示标注速度和进度
- **快捷键支持**: W/S上下导航，U丢弃图像，数字键快速选择标注框

## 安装和运行

### 环境要求
- Python 3.12+
- Windows 10/11 (推荐)

### 安装步骤

#### 使用UV包管理器（推荐）
```bash
# 1. 安装UV
pip install uv

# 2. 安装依赖
uv sync

# 3. 运行程序
python main.py
```

#### 使用pip安装
```bash
# 安装依赖
pip install pillow pyside6 pyinstaller ultralytics

# 运行程序
python main.py
```

## 使用方法

### 基本使用流程

1. **启动程序**
   ```bash
   python main.py
   ```

2. **设置目录**
   - **源目录**: 选择包含`images`和`labels`子文件夹的父目录
   - **目标目录**: 选择存放已标注文件的目标目录

3. **加载图像**
   - 点击"加载图像"按钮
   - 程序会自动按ID分组显示图像

4. **标注操作**
   - 在左侧列表中选择需要标注的图像
   - 在图像预览区查看边界框（可拖拽调整位置和大小）
   - 点击下方对应的船舶类型按钮，完成标注并移动文件
   - 可选择"审核模式"，在该模式下舍弃图像时会删除原文件

### 高级功能使用

#### 批量操作
- 在非分组模式下，可以按住Ctrl多选图像
- 选择多个图像后，点击船舶类型按钮可批量标注

#### AI自动分类
- 将YOLO模型文件放在`pt/`目录下
- 点击"发送单个"按钮使用AI自动分类当前图像

#### 快捷键
- **W**: 上一张图像
- **S**: 下一张图像
- **U**: 批量丢弃当前选中与之前的所有图片（仅在直接加载模式下）
- **T**: 清空当前图像的所有标签
- **Q**: 添加新的标注框
- **数字键1-9**: 选择对应的标注框并弹出类别选择菜单

## 文件格式

### YOLO标签格式
```
<class_id> <center_x> <center_y> <width> <height>
```
所有值都是归一化到0-1范围的浮点数：
- `class_id`: 对应船舶类型编号（0-3）
  - 0: 船牌
  - 1: 船名
  - 2: 国旗
  - 3: 遮挡船名
- `center_x, center_y`: 边界框中心点坐标（相对于图像宽高的比例）
- `width, height`: 边界框的宽和高（相对于图像宽高的比例）

### 目录结构要求
```
源目录/
├── images/          # 图像文件目录
│   ├── image1.jpg
│   ├── image2.jpg
│   └── ...
└── labels/          # 标签文件目录
    ├── image1.txt
    ├── image2.txt
    └── ...
```

### 输出结构
标注完成后，文件会按船舶类型分类保存：
```
目标目录/
├── 船牌/
│   ├── images/
│   └── labels/
├── 船名/
│   ├── images/
│   └── labels/
└── ...
```

## 项目结构

```
yolo-draw/
├── main.py                    # 主程序入口
├── config.py                  # 全局配置文件
├── models/                    # 数据模型
│   ├── __init__.py
│   └── yolo_label.py          # YOLO标签处理模型
├── ui/                        # 用户界面
│   ├── __init__.py
│   ├── main_window_new.py     # 主窗口实现
│   └── components/            # UI组件
├── utils/                     # 工具函数
│   ├── __init__.py
│   ├── file_utils.py          # 文件操作工具
│   ├── image_utils.py         # 图像处理工具
│   └── yolo_model_manager.py  # YOLO模型管理器
├── resources/                 # 资源文件
│   ├── ship_types.json        # 船舶类型定义
│   └── icon.ico               # 应用图标
├── pt/                        # YOLO模型文件目录
├── build.py                   # 应用打包脚本
├── pyproject.toml             # 项目依赖管理
└── uv.lock                    # uv锁定文件
```

## 技术栈

- Python 3.12
- PySide6 6.9.0 (GUI界面)
- Pillow 11.2.1 (图像处理)
- Ultralytics (YOLO模型支持)
- UV (依赖管理)

## 打包分发

可以使用build.py脚本进行应用打包：

```bash
python build.py
```

打包后的应用将保存在output目录下。